{
  "testSingleSidedSpotPositionAggregatesToOnePosition": {
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.066",
        "contracts": "-0.00899",
        "side": "short",
        "base": "ATOM",
        "symbol": "ATOM",
        "unrealizedPnl": null
      }
    ]
  },
  "testMultipleSidedSpotPositionAggregatesToTwoPositions": {
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.066",
        "contracts": "-0.00899",
        "side": "short",
        "base": "ATOM",
        "symbol": "ATOM",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.132",
        "contracts": "-0.01798",
        "side": "short",
        "base": "ATOM",
        "symbol": "ATOM",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "0.0123",
        "contracts": "0.00899",
        "side": "long",
        "symbol": "LINK",
        "base": "LINK",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "0.0123",
        "contracts": "0.00899",
        "side": "long",
        "base": "LINK",
        "symbol": "LINK",
        "unrealizedPnl": null
      }
    ]
  },
  "testMultipleSidedSpotAndPerpPositionAggregatesToTwoPositions": {
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.066",
        "contracts": "-0.00899",
        "side": "short",
        "symbol": "ATOM",
        "base": "ATOM",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.132",
        "contracts": "-0.01798",
        "side": "short",
        "base": "ATOM",
        "symbol": "ATOM",
        "unrealizedPnl": null
      }
    ],
    "perp": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": "7.25",
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.264",
        "contracts": "-0.03596",
        "side": "short",
        "base": "ATOM",
        "info": {
          "symbol": "ATOM-PERP"
        },
        "unrealizedPnl": "-0.0123"
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": "7.16",
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.528",
        "contracts": "-0.07192",
        "side": "short",
        "info": {
          "symbol": "ATOM-PERP"
        },
        "base": "ATOM",
        "unrealizedPnl": "-0.0128"
      }
    ]
  },
  "testMultipleDoubleSidedSpotAndPerpPositionAggregatesTo16Positions1": {
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.066",
        "contracts": "-0.00899",
        "side": "short",
        "symbol": "ATOM",
        "base": "ATOM",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "255",
        "notional": "-17.1",
        "contracts": "-0.067",
        "side": "short",
        "symbol": "BCH",
        "base": "BCH",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "0.618",
        "notional": "5.87",
        "contracts": "9.5",
        "side": "long",
        "symbol": "EOS",
        "base": "EOS",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "70.5",
        "notional": "4.34",
        "contracts": "0.0616",
        "side": "long",
        "symbol": "LTC",
        "base": "LTC",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "1",
        "notional": "-0.00305",
        "contracts": "-0.00305",
        "side": "short",
        "symbol": "USDC",
        "base": "USDC",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "0.565",
        "notional": "12.7",
        "contracts": "22.6",
        "side": "long",
        "symbol": "XRP",
        "base": "XRP",
        "unrealizedPnl": null
      }
    ],
    "perp": [
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.34",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "127",
        "contracts": "5",
        "side": "long",
        "info": {
          "symbol": "BCHUSDT-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "16.015"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.4441308",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "-111",
        "contracts": "-11",
        "side": "short",
        "info": {
          "symbol": "BCHUSD-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "-15.9454"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.5721",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.616",
        "notional": "-86.3",
        "contracts": "-14",
        "side": "short",
        "info": {
          "symbol": "EOSUSDT-PERP"
        },
        "base": "EOS",
        "unrealizedPnl": "-6.146"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.5719",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.616",
        "notional": "80.3",
        "contracts": "8",
        "side": "long",
        "info": {
          "symbol": "EOSUSD-PERP"
        },
        "base": "EOS",
        "unrealizedPnl": "6.17496"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "66",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "70.2",
        "notional": "-70.2",
        "contracts": "-1",
        "side": "short",
        "info": {
          "symbol": "LTCUSDT-PERP"
        },
        "base": "LTC",
        "unrealizedPnl": "-4.23"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "66.09",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "70.3",
        "notional": "70.3",
        "contracts": "7",
        "side": "long",
        "info": {
          "symbol": "LTCUSD-PERP"
        },
        "base": "LTC",
        "unrealizedPnl": "4.42317"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.49991",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.564",
        "notional": "100",
        "contracts": "10",
        "side": "long",
        "info": {
          "symbol": "XRPUSD-PERP"
        },
        "base": "XRP",
        "unrealizedPnl": "12.83206"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.49969",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.564",
        "notional": "-113",
        "contracts": "-2",
        "side": "short",
        "info": {
          "symbol": "XRPUSDT-PERP"
        },
        "base": "XRP",
        "unrealizedPnl": "-12.866"
      }
    ]
  },
  "testMultipleDoubleSidedSpotAndPerpPositionAggregatesTo16Positions2": {
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "7.34",
        "notional": "-0.066",
        "contracts": "-0.00899",
        "side": "short",
        "symbol": "ATOM",
        "base": "ATOM",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "255",
        "notional": "-17.1",
        "contracts": "-0.067",
        "side": "short",
        "symbol": "BCH",
        "base": "BCH",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "0.618",
        "notional": "5.87",
        "contracts": "9.5",
        "side": "long",
        "symbol": "EOS",
        "base": "EOS",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "70.5",
        "notional": "4.34",
        "contracts": "0.0616",
        "side": "long",
        "symbol": "LTC",
        "base": "LTC",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "1",
        "notional": "-0.00305",
        "contracts": "-0.00305",
        "side": "short",
        "symbol": "USDC",
        "base": "USDC",
        "unrealizedPnl": null
      },
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "0.565",
        "notional": "12.7",
        "contracts": "22.6",
        "side": "long",
        "symbol": "XRP",
        "base": "XRP",
        "unrealizedPnl": null
      }
    ],
    "perp": [
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.34",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "127",
        "contracts": "5",
        "side": "long",
        "info": {
          "symbol": "BCHUSDT-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "16.015"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.4441308",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "-111",
        "contracts": "-11",
        "side": "short",
        "info": {
          "symbol": "BCHUSD-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "-15.9454"
      },

      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.5721",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.616",
        "notional": "-86.3",
        "contracts": "-14",
        "side": "short",
        "info": {
          "symbol": "EOSUSDT-PERP"
        },
        "base": "EOS",
        "unrealizedPnl": "-6.146"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.5719",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.616",
        "notional": "80.3",
        "contracts": "8",
        "side": "long",
        "info": {
          "symbol": "EOSUSD-PERP"
        },
        "base": "EOS",
        "unrealizedPnl": "6.17496"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "66",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "70.2",
        "notional": "-70.2",
        "contracts": "-1",
        "side": "short",
        "info": {
          "symbol": "LTCUSDT-PERP"
        },
        "base": "LTC",
        "unrealizedPnl": "-4.23"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "66.09",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "70.3",
        "notional": "70.3",
        "contracts": "7",
        "side": "long",
        "info": {
          "symbol": "LTCUSD-PERP"
        },
        "base": "LTC",
        "unrealizedPnl": "4.42317"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.49991",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.564",
        "notional": "100",
        "contracts": "10",
        "side": "long",
        "info": {
          "symbol": "XRPUSD-PERP"
        },
        "base": "XRP",
        "unrealizedPnl": "12.83206"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "0.49969",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "0.564",
        "notional": "-113",
        "contracts": "-2",
        "side": "short",
        "info": {
          "symbol": "XRPUSDT-PERP"
        },
        "base": "XRP",
        "unrealizedPnl": "-12.866"
      }
    ]
  },
  "testMultipleDoubleSidedSpotAndPerpPositionAggregatesTo3UnbalancedPositionsDueToRounding1": {
    "perp": [
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.34",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "127",
        "contracts": "5",
        "side": "long",
        "info": {
          "symbol": "BCHUSDT-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "16.015"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.4441308",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "-115",
        "contracts": "-11",
        "side": "short",
        "info": {
          "symbol": "BCHUSD-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "-15.9454"
      }
    ],
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "255",
        "notional": "-10.1",
        "contracts": "-0.067",
        "side": "short",
        "symbol": "BCH",
        "base": "BCH",
        "unrealizedPnl": null
      }
    ]
  },
  "testMultipleDoubleSidedSpotAndPerpPositionAggregatesTo3UnbalancedPositionsDueToRounding2": {
    "perp": [
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.34",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "127",
        "contracts": "5",
        "side": "long",
        "info": {
          "symbol": "BCHUSDT-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "16.015"
      },
      {
        "timestamp": "2023-10-26 11:13:44",
        "avgPrice": "221.4441308",
        "leverage": "30",
        "marginMode": "cross",
        "markPrice": "253",
        "notional": "-110",
        "contracts": "-11",
        "side": "short",
        "info": {
          "symbol": "BCHUSD-PERP"
        },
        "base": "BCH",
        "unrealizedPnl": "-15.9454"
      }
    ],
    "spot": [
      {
        "timestamp": "2023-10-26 11:13:53",
        "avgPrice": null,
        "leverage": null,
        "marginMode": null,
        "markPrice": "255",
        "notional": "-10.1",
        "contracts": "-0.067",
        "side": "short",
        "symbol": "BCH",
        "base": "BCH",
        "unrealizedPnl": null
      }
    ]
  }
}
